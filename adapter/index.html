<h1>Adapter</h1>

<p>Also Known As: <strong>Wrapper</strong></p>

<h2>Definition</h2>

<p>Convert the interface of a class into another interface clients expect.
Adapter lets classes work together that couldn't otherwise because of
incompatible interfaces.</p>

<h2>Diagram</h2>

<div class="gallery medium">
    <a href="http://joshldavis.com/rust-design-patterns/img/adapter-structure.png" rel="lightbox"
    title="Structure of the Adapter Pattern">
        <img src="http://joshldavis.com/rust-design-patterns/img/adapter-structure.png" width="620">
        <span>Structure of the Adapter Pattern</span>
    </a>
</div>


<h2>Problem</h2>

<p>Often systems of code need to interact. If this is designed from the start then
there is no problem. One system defines an abstraction and the other system
adds implementation for that interface.</p>

<p>The problem arises when the system that uses the abstraction changes its
requirements. If the implementation changes, then the interface is now broken.</p>

<h2>Wrong Solution</h2>

<p>One way to fix this is to just rewrite the system the interface to still match
the new implementation. This is <em>can</em> work in some cases but depending on the
size of the system it might not be feasible.</p>

<h2>Correct Solution</h2>

<p>The correct solution using the Adapter pattern would be to just make a middle
layer that <strong>adapts</strong> the interface the first system expects into the new
implementation.</p>

<p>This mitigates the need to rewrite both systems yet allows flexibility in case
systems continue to change.</p>

<h2>Example</h2>

<p>Back in the 60s there were tons of Astronatus working for NASA. At the
time, all they needed to learn was how to fly NASA's ships. When ever NASA
came out with a new ship, it was similar to the olds ones. This worked for
decades. All was well in the galaxy.</p>

<p>However in 2010, NASA shut down the Space Shuttle program. The Astronauts
were out of jobs and started to look for new ones. Once the Astronauts realized
that their space suits made for poor work attire on Earth, they knew they had to
revisit the stars. So they went to the next best company to work for, SpaceX.
When they got to SpaceX they realized that technology had changed quite a bit
since the 60s. SpaceX realized this as well, so to compensate for the Astronauts
they came up with an idea to use the Adapter pattern.</p>

<p>The smart SpaceX engineers made a new class that just 'Adapted' the old
interface of the NASA Space Shuttles to SpaceX's new rocket ships. The
Astronauts now had no problem flying SpaceX's ships through the galaxy.</p>

<p>Together the Astronauts and SpaceX were able to settle the galaxy far
and wide.</p>

<h3>Example Diagram</h3>

<div class="gallery medium">
    <a href="http://joshldavis.com/rust-design-patterns/img/adapter-example.png" rel="lightbox" title="Example of the Adapter Design Pattern.">
        <img src="http://joshldavis.com/rust-design-patterns/img/adapter-example.png" width="620">
        <span>Example of the Adapter Design Pattern.</span>
    </a>
</div>


<h3>Example Code</h3>

<p>View <a href="https://github.com/jdavis/rust-design-patterns/blob/master/patterns/adapter.rs">adapter.rs</a> on GitHub</p>

<div class="highlight"><pre><code class="rust"><span class="cm">/*</span>
<span class="cm"> * Core Trait that defines a basic Rocket Ship</span>
<span class="cm"> */</span>
<span class="k">trait</span> <span class="n">RocketShip</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="n">turn_on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">turn_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">blast_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Basic struct for a NASA Ship</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">NASAShip</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Implement RocketShip trait to add functionality to NASAShip</span>
<span class="cm"> */</span>
<span class="k">impl</span> <span class="n">RocketShip</span> <span class="k">for</span> <span class="n">NASAShip</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="n">turn_on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;NASA Ship is turning on.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">turn_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;NASA Ship is turning off.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">blast_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;NASA Ship is blasting off.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;NASA Ship is flying away.&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Uh oh, here is our problem. It&#39;s the amazingly advanced SpaceX ship that our</span>
<span class="cm"> * astronaut doesn&#39;t know how to pilot.</span>
<span class="cm"> */</span>
<span class="k">trait</span> <span class="n">SpaceXShip</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="n">ignition</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">launch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
    <span class="k">fn</span> <span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Basic struct for a SpaceX Dragon rocket ship</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">SpaceXDragon</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Implement the SpaceX trait to add functionality to the Space X Dragon</span>
<span class="cm"> */</span>
<span class="k">impl</span> <span class="n">SpaceXShip</span> <span class="k">for</span> <span class="n">SpaceXDragon</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="n">ignition</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Turning Dragon&#39;s ignition.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Turning on the Dragon.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Turing off the Dragon.&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">launch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Launching the Dragon&quot;</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">println</span><span class="p">(</span><span class="s">&quot;The Dragon is flying away.&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Uh oh, the new SpaceXDragon doesn&#39;t implement the RocketShip interface. We</span>
<span class="cm"> * need to create an adapter that does.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Adapter to adapt anything that implements SpaceXShip to the RocketShip trait</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">SpaceXAdapter</span> <span class="p">{</span>
    <span class="n">ship</span><span class="o">:</span> <span class="n">SpaceXDragon</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * SpaceX Adapter that adds RocketShip traits to any SpaceXShip</span>
<span class="cm"> */</span>
<span class="k">impl</span> <span class="n">RocketShip</span> <span class="k">for</span> <span class="n">SpaceXAdapter</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="n">turn_on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ship</span><span class="p">.</span><span class="n">ignition</span><span class="p">();</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ship</span><span class="p">.</span><span class="n">on</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">turn_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ship</span><span class="p">.</span><span class="n">off</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">blast_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ship</span><span class="p">.</span><span class="n">launch</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ship</span><span class="p">.</span><span class="n">fly</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Basic function to pilot ships that implement the RocketShip trait</span>
<span class="cm"> */</span>
<span class="k">fn</span> <span class="n">pilot</span><span class="o">&lt;</span><span class="n">S</span><span class="o">:</span> <span class="n">RocketShip</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ship</span><span class="o">:</span> <span class="o">&amp;</span><span class="n">S</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ship</span><span class="p">.</span><span class="n">turn_on</span><span class="p">();</span>
    <span class="n">ship</span><span class="p">.</span><span class="n">blast_off</span><span class="p">();</span>
    <span class="n">ship</span><span class="p">.</span><span class="n">fly</span><span class="p">();</span>
    <span class="n">ship</span><span class="p">.</span><span class="n">turn_off</span><span class="p">();</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a new NASAShip</span>
    <span class="k">let</span> <span class="n">saturn5</span> <span class="o">=</span> <span class="n">NASAShip</span><span class="p">;</span>

    <span class="c1">// Let&#39;s fly our NASAShip</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;Piloting the Saturn 5.&quot;</span><span class="p">);</span>
    <span class="n">pilot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">saturn5</span><span class="p">);</span>

    <span class="c1">// Create a Dragon</span>
    <span class="k">let</span> <span class="n">dragon</span> <span class="o">=</span> <span class="n">SpaceXDragon</span><span class="p">;</span>

    <span class="c1">// Uh oh, our pilot function doesn&#39;t recognize this ship...</span>
    <span class="c1">// pilot(&amp;dragon); &lt;-- Gives a compile time error.</span>

    <span class="c1">// Let&#39;s Adapt our SpaceXDragon ship</span>
    <span class="k">let</span> <span class="n">dragon_adapter</span> <span class="o">=</span> <span class="n">SpaceXAdapter</span> <span class="p">{</span>
        <span class="n">ship</span><span class="o">:</span> <span class="n">dragon</span>
    <span class="p">};</span>

    <span class="c1">// Now we can pilot the Dragon!</span>
    <span class="n">println</span><span class="p">(</span><span class="s">&quot;Piloting the Dragon Adapter.&quot;</span><span class="p">);</span>
    <span class="n">pilot</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dragon_adapter</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>



